name: Deploy to Heroku
on:
  repository_dispatch:
    types: [deploy]
jobs:
  deploy:
    deploy:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v2

        - name: Get Heroku CLI
          run: sudo curl https://cli-assets.heroku.com/install.sh | sh

        - name: Authenticate with Heroku
          env:
            HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
          run: heroku container:login

        - name: Push to Heroku
          env:
            HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
          run: |
            mv ./docker/food-truck-api.Dockerfile ./docker/food-truck-api.Dockerfile.web
            mv ./docker/food-truck-frontend.Dockerfile ./docker/food-truck-frontend.Dockerfile.web
            heroku container:push --recursive